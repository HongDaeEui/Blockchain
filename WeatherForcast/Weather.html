<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="./css/style.css" type="text/css">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="./lib/web3.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible&display=swap" rel="stylesheet">

  <title>My Weather App</title>
</head>

<body>

  <!-- banner -->
  <div class="jumbotron text-center">
    <h3 style="font-weight: bold;">Challenge to predict the weather !</h3>
  </div>

  <!-- title -->
  <div class="container w-75 mt-5 p-5 shadow text-center bg-warning text-dark">
    <h2>Current Weather in Seoul, Korea</h2>
    <hr />
    <div class="row bg-success p-5 rounded-circle">
      <div class="col-5">
        <img id="icon" />
      </div>

      <!-- weather info -->
      <div class="col-7 m-auto">
        <div style="display: flex;">
          <div id="timer" style="display:inline;" onclick="startBet(), getContract()">Betting start</div>
          <h2 class="display-3" id="weather"></h2>
        </div>
        <strong id="temp"></strong><br />
        Min: <span id="min"></span>°C, Max: <span id="max"></span>°C<br />
        Wind: <span id="wind"></span>m/s<br />
        Current time: <span id="time"></span>
      </div>
    </div>

    <!-- user input -->
    <div class="row bg-primary p-5 rounded-circle" style="padding-bottom:10px;">
      <h3>After an hour, Guess the weather in Seoul!</h3>

      <input type="radio" value="1" name="weather"> Sunny <img src="img/weather_sun_sunny_sunshine_icon_124153.svg"
        alt="sunny" width="20">
      <input type="radio" value="2" name="weather"> Cloudy <img src="img/weather_cloud_cloudy_icon_124152.svg" hj
        alt="sunny" width="20">
      <input type="radio" value="3" name="weather"> Rainny <img
        src="img/weather_rain_raining_cloud_cloudy_icon_124154.svg" alt="sunny" width="20">
      <input type=" text" id="tokenInput" style="width:80px;color: black;" placeholder="100 day" value="100">
      <button class="btn btn-info btn-sm" onclick="goBetting()">Go</button>
      <button class="btn btn-info btn-sm" onclick="removeVotes()">Again</button>
      <button class="btn btn-info btn-sm" onclick="getToken()">Get Token</button>
    </div>

    <!-- result btn -->
    <div class="row bg-info p-5 rounded-circle" style="padding:10px 0;">
      <button class="btn btn-success btn-sm" style="color:white;" onclick="getVoter()">Your Forecast</button>
      <button class="btn btn-success btn-sm" style="color:white;" onclick="getVote()">Current Rate</button>
      <button class="btn btn-success btn-sm" style="color:white;" onclick="result()">Get Result</button>
      <button class="btn btn-success btn-sm" style="color:white;" onclick="getPrizes()">Your Prize</button>
    </div>

    <!-- result info -->
    <div class="finder">
      <div class="cards" id="yourforecast" style="width: 20rem;display: none;">
        <img src="" class="card-img-top" alt="...">
      </div>
      <div class="cards" id="currentrate" style="width: 20rem;display: none;">
      </div>
      <div class="cards" id="getresult" style="width: 20rem;display: none;">
      </div>
      <div class="cards" id="yourprize" style="width: 20rem;display: none;">
      </div>
    </div>

    <!-- administer function -->
    <div class="administer row bg-danger p-5 rounded-circle" style="padding-bottom:10px;">
      <button class="btn btn-primary btn-sm" style="color:white;" onclick="createContract()">create contract</button>
      <button class="btn btn-primary btn-sm" style="color:white;" onclick="getContract()">getContract</button>
      <button class="btn btn-primary btn-sm" style="color:white;" onclick="weather()">weather update</button>
      <div id="account"></div>
      <div id="contract"></div>
    </div>

  </div>

</body>
<script>
  //web3.js
  let provider;
  let web3;
  let account;
  let contract;
  let newContract;
  let weatherInfo = "";

  async function init() {

    if (window.ethereum) {
      web3 = new Web3(window.ethereum);
      try {
        // Request account access if needed
        await window.ethereum.enable();
        // Acccounts now exposed
        web3.eth.getAccounts().then(function (accounts) {
          account = accounts[0]
          document.getElementById("account").innerText = account
        })
      } catch (error) {}
    }
    // Legacy dapp browsers...
    else if (window.web3) {
      // Use Mist/MetaMask's provider.
      web3 = window.web3;
      console.log("Injected web3 detected.");
    }
  }
  init()

  //connect contract
  function getContract() {
    let abi = [{
        "inputs": [{
          "internalType": "uint256",
          "name": "total",
          "type": "uint256"
        }],
        "stateMutability": "nonpayable",
        "type": "constructor"
      },
      {
        "anonymous": false,
        "inputs": [{
            "indexed": true,
            "internalType": "address",
            "name": "tokenOwner",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "spender",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "tokens",
            "type": "uint256"
          }
        ],
        "name": "Approval",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [{
            "indexed": true,
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "tokens",
            "type": "uint256"
          }
        ],
        "name": "Transfer",
        "type": "event"
      },
      {
        "inputs": [{
            "internalType": "address",
            "name": "owner",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "delegate",
            "type": "address"
          }
        ],
        "name": "allowance",
        "outputs": [{
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [{
            "internalType": "address",
            "name": "delegate",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "numTokens",
            "type": "uint256"
          }
        ],
        "name": "approve",
        "outputs": [{
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [{
          "internalType": "address",
          "name": "tokenOwner",
          "type": "address"
        }],
        "name": "balanceOf",
        "outputs": [{
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "decimals",
        "outputs": [{
          "internalType": "uint8",
          "name": "",
          "type": "uint8"
        }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "getToken",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "name",
        "outputs": [{
          "internalType": "string",
          "name": "",
          "type": "string"
        }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "symbol",
        "outputs": [{
          "internalType": "string",
          "name": "",
          "type": "string"
        }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "totalSupply",
        "outputs": [{
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [{
            "internalType": "address",
            "name": "receiver",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "numTokens",
            "type": "uint256"
          }
        ],
        "name": "transfer",
        "outputs": [{
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [{
            "internalType": "address",
            "name": "owner",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "buyer",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "numTokens",
            "type": "uint256"
          }
        ],
        "name": "transferFrom",
        "outputs": [{
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ]

    let abi2 = [{
        "inputs": [],
        "name": "destroy",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "removeVote",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [{
          "internalType": "uint256",
          "name": "weatherCode",
          "type": "uint256"
        }],
        "name": "result",
        "outputs": [{
            "internalType": "bool",
            "name": "",
            "type": "bool"
          },
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "voteCloudy",
        "outputs": [{
          "internalType": "bool",
          "name": "sucess",
          "type": "bool"
        }],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "voteRainny",
        "outputs": [{
          "internalType": "bool",
          "name": "sucess",
          "type": "bool"
        }],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "votersResult",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "voteSunny",
        "outputs": [{
          "internalType": "bool",
          "name": "success",
          "type": "bool"
        }],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "stateMutability": "nonpayable",
        "type": "constructor"
      },
      {
        "inputs": [],
        "name": "getPrizes",
        "outputs": [{
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "getVote",
        "outputs": [{
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "getVoter",
        "outputs": [{
          "internalType": "enum WeatherBet.VoteTypes",
          "name": "",
          "type": "uint8"
        }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "getVotersResult",
        "outputs": [{
          "components": [{
              "internalType": "address",
              "name": "vote",
              "type": "address"
            },
            {
              "internalType": "enum WeatherBet.VoteTypes",
              "name": "result",
              "type": "uint8"
            }
          ],
          "internalType": "struct WeatherBet.VotersResult[]",
          "name": "",
          "type": "tuple[]"
        }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "owner",
        "outputs": [{
          "internalType": "address",
          "name": "",
          "type": "address"
        }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [{
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }],
        "name": "voters",
        "outputs": [{
          "internalType": "address",
          "name": "",
          "type": "address"
        }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [{
          "internalType": "address",
          "name": "",
          "type": "address"
        }],
        "name": "votes",
        "outputs": [{
          "internalType": "enum WeatherBet.VoteTypes",
          "name": "",
          "type": "uint8"
        }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "winners",
        "outputs": [{
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }],
        "stateMutability": "view",
        "type": "function"
      }
    ]
    contract = new web3.eth.Contract(abi, "0x00906AC77D16753dBEE1ddbab66a5a47936c4CDC");
    document.getElementById("contract").innerText = contract._address;
    contract2 = new web3.eth.Contract(abi2,
      "0x81cA438Ede96AbeDA23D242Dd7dfe8CC43be5A57");
    document.getElementById("contract").innerText += contract2._address;
    console.log(contract2);
  }
  getContract();

  function createContract() {
    let bytecode =
      "0x60806040523480156200001157600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000600160008073ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff02191690836003811115620000b857620000b762000176565b5b02179055504260048190555061546042620000d49190620000e0565b600581905550620001a5565b6000620000ed826200013d565b9150620000fa836200013d565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0382111562000132576200013162000147565b5b828201905092915050565b6000819050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b61165f80620001b56000396000f3fe608060405234801561001057600080fd5b50600436106100b45760003560e01c806383197ef01161007157806383197ef01461016e578063b43b5fb014610178578063bd78f0fe14610182578063d8bff5a5146101a0578063d953cea6146101d0578063da58c7d9146101ee576100b4565b80630242f351146100b95780632b37f53c146100d95780633c594059146100f757806349aa4ee21461012857806379471101146101325780637c5b41b414610150575b600080fd5b6100c161021e565b6040516100d0939291906113a6565b60405180910390f35b6100e16104bb565b6040516100ee919061138b565b60405180910390f35b610111600480360381019061010c9190611150565b61050f565b60405161011f929190611362565b60405180910390f35b610130610826565b005b61013a610953565b6040516101479190611347565b60405180910390f35b610158610a42565b6040516101659190611347565b60405180910390f35b610176610b32565b005b610180610ba3565b005b61018a610dc6565b6040516101979190611325565b60405180910390f35b6101ba60048036038101906101b591906110f6565b610eb2565b6040516101c7919061138b565b60405180910390f35b6101d8610ed2565b6040516101e59190611347565b60405180910390f35b61020860048036038101906102039190611150565b610fc2565b60405161021591906112b8565b60405180910390f35b6000806000600554421061023157600080fd5b6000806000805b6002805490508110156104a957600160038111156102595761025861156d565b5b60016000600284815481106102715761027061159c565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1660038111156102f6576102f561156d565b5b141561030b578380610307906114c6565b9450505b6002600381111561031f5761031e61156d565b5b60016000600284815481106103375761033661159c565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1660038111156103bc576103bb61156d565b5b14156103d15782806103cd906114c6565b9350505b6003808111156103e4576103e361156d565b5b60016000600284815481106103fc576103fb61159c565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1660038111156104815761048061156d565b5b1415610496578180610492906114c6565b9250505b80806104a1906114c6565b915050610238565b50828282955095509550505050909192565b6000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16905090565b60008060055442101561052157600080fd5b600080600073ca8d65b86d557f7bd84a4f8dc1ec25a2255d9c1973ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b815260040161057391906112b8565b60206040518083038186803b15801561058b57600080fd5b505afa15801561059f573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906105c3919061117d565b90508560038111156105d8576105d761156d565b5b60038111156105ea576105e961156d565b5b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1660038111156106495761064861156d565b5b141561080f576001925060005b600280549050811015610757578660038111156106765761067561156d565b5b60038111156106885761068761156d565b5b60016000600284815481106106a05761069f61159c565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1660038111156107255761072461156d565b5b1415610744576003600081548092919061073e906114c6565b91905055505b808061074f906114c6565b915050610656565b50600354816107669190611416565b915073ca8d65b86d557f7bd84a4f8dc1ec25a2255d9c1973ffffffffffffffffffffffffffffffffffffffff1663a9059cbb33846040518363ffffffff1660e01b81526004016107b79291906112fc565b602060405180830381600087803b1580156107d157600080fd5b505af11580156107e5573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906108099190611123565b50610818565b60009250600091505b828294509450505050915091565b600554421061083457600080fd5b61083d33611001565b61084657600080fd5b6000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908360038111156108a9576108a861156d565b5b021790555073ca8d65b86d557f7bd84a4f8dc1ec25a2255d9c1973ffffffffffffffffffffffffffffffffffffffff1663a9059cbb3360646040518363ffffffff1660e01b81526004016108fe9291906112d3565b602060405180830381600087803b15801561091857600080fd5b505af115801561092c573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906109509190611123565b50565b6000600554421061096357600080fd5b61096c33611001565b6109d4576002339080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b60018060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff02191690836003811115610a3657610a3561156d565b5b02179055506001905090565b60006005544210610a5257600080fd5b610a5b33611001565b610ac3576002339080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b6002600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff02191690836003811115610b2657610b2561156d565b5b02179055506001905090565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610b8a57600080fd5b3373ffffffffffffffffffffffffffffffffffffffff16ff5b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610bfb57600080fd5b60005b600280549050811015610dc3576007604051806040016040528060028481548110610c2c57610c2b61159c565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020016001600060028681548110610c8a57610c8961159c565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff166003811115610d0f57610d0e61156d565b5b8152509080600181540180825580915050600190039060005260206000200160009091909190915060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160000160146101000a81548160ff02191690836003811115610da957610da861156d565b5b021790555050508080610dbb906114c6565b915050610bfe565b50565b60606007805480602002602001604051908101604052809291908181526020016000905b82821015610ea9578382906000526020600020016040518060400160405290816000820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020016000820160149054906101000a900460ff166003811115610e8457610e8361156d565b5b6003811115610e9657610e9561156d565b5b8152505081526020019060010190610dea565b50505050905090565b60016020528060005260406000206000915054906101000a900460ff1681565b60006005544210610ee257600080fd5b610eeb33611001565b610f53576002339080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b6003600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff02191690836003811115610fb657610fb561156d565b5b02179055506001905090565b60028181548110610fd257600080fd5b906000526020600020016000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000806000905060028054905081101561109b578273ffffffffffffffffffffffffffffffffffffffff16600282815481106110405761103f61159c565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141561109157600191505061109d565b600091505061109d565b505b919050565b6000813590506110b1816115e4565b92915050565b6000815190506110c6816115fb565b92915050565b6000813590506110db81611612565b92915050565b6000815190506110f081611612565b92915050565b60006020828403121561110c5761110b6115cb565b5b600061111a848285016110a2565b91505092915050565b600060208284031215611139576111386115cb565b5b6000611147848285016110b7565b91505092915050565b600060208284031215611166576111656115cb565b5b6000611174848285016110cc565b91505092915050565b600060208284031215611193576111926115cb565b5b60006111a1848285016110e1565b91505092915050565b60006111b6838361127a565b60408301905092915050565b6111cb81611447565b82525050565b6111da81611447565b82525050565b60006111eb826113ed565b6111f58185611405565b9350611200836113dd565b8060005b8381101561123157815161121888826111aa565b9750611223836113f8565b925050600181019050611204565b5085935050505092915050565b61124781611459565b82525050565b611256816114a2565b82525050565b611265816114a2565b82525050565b611274816114b4565b82525050565b60408201600082015161129060008501826111c2565b5060208201516112a3602085018261124d565b50505050565b6112b281611498565b82525050565b60006020820190506112cd60008301846111d1565b92915050565b60006040820190506112e860008301856111d1565b6112f5602083018461126b565b9392505050565b600060408201905061131160008301856111d1565b61131e60208301846112a9565b9392505050565b6000602082019050818103600083015261133f81846111e0565b905092915050565b600060208201905061135c600083018461123e565b92915050565b6000604082019050611377600083018561123e565b61138460208301846112a9565b9392505050565b60006020820190506113a0600083018461125c565b92915050565b60006060820190506113bb60008301866112a9565b6113c860208301856112a9565b6113d560408301846112a9565b949350505050565b6000819050602082019050919050565b600081519050919050565b6000602082019050919050565b600082825260208201905092915050565b600061142182611498565b915061142c83611498565b92508261143c5761143b61153e565b5b828204905092915050565b600061145282611478565b9050919050565b60008115159050919050565b6000819050611473826115d0565b919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b60006114ad82611465565b9050919050565b60006114bf82611498565b9050919050565b60006114d182611498565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8214156115045761150361150f565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b600080fd5b600481106115e1576115e061156d565b5b50565b6115ed81611447565b81146115f857600080fd5b50565b61160481611459565b811461160f57600080fd5b50565b61161b81611498565b811461162657600080fd5b5056fea26469706673582212201a326277300b99da59fea1841fde284064de6c91e46ae20ca3e0285b15359f2764736f6c63430008060033"
    web3.eth.sendTransaction({
      from: account,
      data: bytecode
    }).on('receipt', function (receipt) {
      console.log(receipt.contractAddress)
      newContract = receipt.contractAddress;
    })
  }

  //get Token
  function getToken() {
    contract.methods.getToken().send({
      from: account
    })
  }

  //removeVote
  function removeVotes() {
    contract2.methods.removeVote().send({
      from: account
    })
  }

  //go betting
  function goBetting() {
    const weatherList = document.getElementsByName('weather');
    let numToken = document.getElementById('tokenInput').value;
    console.log(numToken);

    weatherList.forEach((choice) => {
      if (choice.checked) {
        if (choice.value == "1") {
          contract2.methods.voteSunny().send({
            from: account
          })
          console.log(choice.value);
        } else if (choice.value == "2") {
          contract2.methods.voteCloudy().send({
            from: account
          }).on('receipt', function () {
            contract.methods.transfer("0xA90FF71570e73AD4646a9e80F4ba9B82F49c5948", numToken).send({
              from: account
            })
          })
        } else if (choice.value == "3") {
          contract2.methods.voteRainny().send({
            from: account
          })
        }
      }
    })


  }

  //your forecast
  function getVoter() {
    let weatherimg = ["img/challenge.svg", "img/weather_sun_sunny_sunshine_icon_124153.svg",
      "img/weather_cloud_cloudy_icon_124152.svg",
      "img/weather_rain_raining_cloud_cloudy_icon_124154.svg"
    ];
    let weatherinfo = ["Challenge yourself to betting", "Your choice is Sunny", "Your choice is Cloudy",
      "Your choice is Rainny"
    ]
    if (document.getElementById("yourforecast").style.display == "none") {
      document.getElementById("yourforecast").style.display = "";
    } else if (document.getElementById("yourforecast").style.display != "none") {
      document.getElementById("yourforecast").style.display = "none";
    }

    contract2.methods.getVoter().call({
      from: account
    }).then(function (result) {
      console.log(result);

      document.getElementById("yourforecast").innerHTML = "<img src='" + weatherimg[parseInt(result)] + "'>";
      document.getElementById("yourforecast").innerHTML += "<p></p><p>" + weatherinfo[parseInt(result)] +
        "</p><p>Good Luck !</p>"
    });

  }

  //current rate
  function getVote() {
    if (document.getElementById("currentrate").style.display == "none") {
      document.getElementById("currentrate").style.display = "";
    } else if (document.getElementById("currentrate").style.display != "none") {
      document.getElementById("currentrate").style.display = "none";
    }
    contract2.methods.getVote().call({
      from: account
    }).then(function (result) {
      console.log(result);
      document.getElementById("currentrate").innerHTML =
        "<img src='img/happysun.png' class='card-img-top' alt=''...''>"
      document.getElementById("currentrate").innerHTML +=
        "<p>Sunny got  <span style='color:red;font-weight:bold'>" +
        result[0] + "</span> votes.</p>";
      document.getElementById("currentrate").innerHTML +=
        "<p>Cloudy got  <span style='color:red;font-weight:bold'>" +
        result[1] + "</span> votes.</p>";
      document.getElementById("currentrate").innerHTML +=
        "<p>Rainny got  <span style='color:red;font-weight:bold'>" +
        result[2] + "</span> votes.</p>";

    });
  }

  //get result
  function result() {
    let weatherCode = 0;
    if (document.getElementById("getresult").style.display == "none") {
      document.getElementById("getresult").style.display = "";
    } else if (document.getElementById("getresult").style.display != "none") {
      document.getElementById("getresult").style.display = "none";
    }

    if (weatherInfo.indexOf('clear') > -1 || weatherInfo.indexOf('few') > -1) {
      weatherCode = 1;
    } else if (weatherInfo.indexOf('cloud') > -1) {
      weatherCode = 2;
    } else if (weatherInfo.indexOf('rain') > -1) {
      weatherCode = 3;
    }
    contract2.methods.result(weatherCode).send({
      from: account
    }).then(function (result) {
      console.log(result);
      if (result[0]) {
        document.getElementById("getresult").innerHTML =
          "<img src='img/victory.png' class='card-img-top' alt=''...''>";
        document.getElementById("getresult").innerHTML +=
          "<p> You're a weather prophet </p>";
      } else {
        document.getElementById("getresult").innerHTML =
          "<img src='img/again.png' class='card-img-top' alt=''...''>";
        document.getElementById("getresult").innerHTML +=
          "<p> Do it one more time </p>";
      }
    })

  }

  //your prize
  function getPrizes() {
    if (document.getElementById("yourprize").style.display == "none") {
      document.getElementById("yourprize").style.display = "";
    } else if (document.getElementById("yourprize").style.display != "none") {
      document.getElementById("yourprize").style.display = "none";
    }
    contract2.methods.getPrizes().call({
      from: account
    }).then(function (result) {
      document.getElementById("yourprize").innerHTML =
        "<img src='img/money2.png' class='card-img-top' alt=''...''>";
      document.getElementById("yourprize").innerHTML += "<p></p>";
      document.getElementById("yourprize").innerHTML +=
        "<p> Your prize is <span style='color:red;font-weight:bold;font-size:20px'>" + result + "</span></p>";
    });
  }

  //weather screen
  function weather() {
    let temp = document.querySelector("#temp");
    let min = document.querySelector("#min");
    let max = document.querySelector("#max");
    let wind = document.querySelector("#wind");
    let weather = document.querySelector("#weather");
    let time = document.querySelector("#time")
    let icon = document.querySelector("#icon");
    let icon_url =
      "https://openweathermap.org/themes/openweathermap/assets/vendor/owm/img/widgets/";

    axios
      .get(
        "https://api.openweathermap.org/data/2.5/find?q=Seoul&units=metric&appid=1034276485da9af63063f5b42dfa7820"
      )
      .then(function (response) {
        console.log(response.data);
        let wdata = response.data.list[0];
        let exdata = response.data.list[0].weather[0];
        var now = new Date();
        var hours = ('0' + now.getHours()).slice(-2);
        var minutes = ('0' + now.getMinutes()).slice(-2);
        var seconds = ('0' + now.getSeconds()).slice(-2);
        var timeString = hours + ':' + minutes + ':' + seconds;

        temp.innerText = wdata.main.temp + "°C";
        min.innerText = wdata.main.temp_min;
        max.innerText = wdata.main.temp_max;
        wind.innerText = wdata.wind.speed;
        time.innerText = timeString;


        weather.innerText = exdata.main + "," + exdata.description;
        icon.setAttribute("src", icon_url + exdata.icon + ".png");
        weatherInfo = exdata.description;
        console.log(exdata.description);
      })
      .catch(function (error) {
        console.log(error);
      })

  }


  setTimeout(function request() {
    weather();
    setTimeout(request, 1440000);
  }, 0);

  //timer
  let time = 21600;
  let hour = "";
  let min = "";
  let sec = "";

  function startBet() {
    var x = setInterval(startTimer, 1000);
  }

  function startTimer() {

    if (time >= 0) {
      hour = parseInt(time / 3600);
      min = parseInt((time % 3600) / 60);
      sec = time % 60;
      document.getElementById("timer").innerHTML = "Before Closing <br>" +
        hour + "hour " + min + "min " + sec + "s ";
      time--;
    }

    if (time < 0) {
      clearInterval(x);
      document.getElementById("timer").innerHTML = "Next game";
    }
  }

  //timer restart
  function restartTimer() {
    if (document.getElementById("timer").innerText == "Next game") {
      time = 21600;
      setTimeout(function request() {
        startTimer();
        setTimeout(request, 1000);
      }, 1000);
    }
  }
  const y = document.getElementById("timer");
  y.addEventListener('click', restartTimer);
</script>

</html>