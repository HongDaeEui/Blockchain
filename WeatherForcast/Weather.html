<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="./css/style.css" type="text/css">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <title>My Weather App</title>
</head>

<body>

  <!-- banner -->
  <div class="jumbotron text-center">
    <h3 style="font-weight: bold;">Challenge to predict the weather !</h3>
  </div>

  <!-- title -->
  <div class="container w-75 mt-5 p-5 shadow text-center bg-warning text-dark">
    <h2>Current Weather in Seoul, Korea</h2>
    <hr />
    <div class="row bg-success p-5 rounded-circle">
      <div class="col-5">
        <img id="icon" />
      </div>

      <!-- weather info -->
      <div class="col-7 m-auto">
        <div style="display: flex;">
          <div id="timer" style="display:inline;" onclick="startBet()">Betting start</div>
          <h2 class="display-3" id="weather"></h2>
        </div>
        <strong id="temp"></strong><br />
        Min: <span id="min"></span>°C, Max: <span id="max"></span>°C<br />
        Wind: <span id="wind"></span>m/s<br />
        Current time: <span id="time"></span>
      </div>
    </div>

    <!-- user input -->
    <div class="row bg-primary p-5 rounded-circle" style="padding-bottom:10px;">
      <h3>After an hour, Guess the weather in Seoul!</h3>

      <input type="radio" value="1" name="weather"> Sunny <img src="img/weather_sun_sunny_sunshine_icon_124153.svg"
        alt="sunny" width="20">
      <input type="radio" value="2" name="weather"> Cloudy <img src="img/weather_cloud_cloudy_icon_124152.svg"
        alt="sunny" width="20">
      <input type="radio" value="3" name="weather"> Rainny <img
        src="img/weather_rain_raining_cloud_cloudy_icon_124154.svg" alt="sunny" width="20">
      <input type=" text" id="tokenInput" style="width:80px;" placeholder="bet token">
      <button class="btn btn-success btn-sm">Go</button>
    </div>

    <!-- result -->
    <div class="row bg-info p-5 rounded-circle" style="padding:10px 0;">
      <button class="btn btn-success btn-sm" style="color:white;">Your Forecast</button>
      <button class="btn btn-success btn-sm" style="color:white;">Current Rate</button>
      <button class="btn btn-success btn-sm" style="color:white;">Get Result</button>
      <button class="btn btn-success btn-sm" style="color:white;">Your Prize</button>
    </div>

  </div>
  <script>
    //weather screen
    function weather() {
      let temp = document.querySelector("#temp");
      let min = document.querySelector("#min");
      let max = document.querySelector("#max");
      let wind = document.querySelector("#wind");
      let weather = document.querySelector("#weather");
      let time = document.querySelector("#time")
      let icon = document.querySelector("#icon");
      let icon_url =
        "https://openweathermap.org/themes/openweathermap/assets/vendor/owm/img/widgets/";

      axios
        .get(
          "https://api.openweathermap.org/data/2.5/find?q=Seoul&units=metric&appid=1034276485da9af63063f5b42dfa7820"
        )
        .then(function (response) {
          console.log(response.data);
          let wdata = response.data.list[0];
          let exdata = response.data.list[0].weather[0];
          var now = new Date();
          var hours = ('0' + now.getHours()).slice(-2);
          var minutes = ('0' + now.getMinutes()).slice(-2);
          var seconds = ('0' + now.getSeconds()).slice(-2);
          var timeString = hours + ':' + minutes + ':' + seconds;

          temp.innerText = wdata.main.temp + "°C";
          min.innerText = wdata.main.temp_min;
          max.innerText = wdata.main.temp_max;
          wind.innerText = wdata.wind.speed;
          time.innerText = timeString;


          weather.innerText = exdata.main + "," + exdata.description;
          icon.setAttribute("src", icon_url + exdata.icon + ".png");
        })
        .catch(function (error) {
          console.log(error);
        })
    }

    setTimeout(function request() {
      weather();
      setTimeout(request, 1439000);
    }, 0);

    //timer
    let time = 21600;
    let hour = "";
    let min = "";
    let sec = "";

    function startBet() {
      var x = setInterval(startTimer, 1000);
    }

    function startTimer() {

      if (time >= 0) {
        hour = parseInt(time / 3600);
        min = parseInt((time % 3600) / 60);
        sec = time % 60;
        document.getElementById("timer").innerHTML = "Before Closing <br>" +
          hour + "hour " + min + "min " + sec + "s ";
        time--;
      }

      if (time < 0) {
        clearInterval(x);
        document.getElementById("timer").innerHTML = "Next game";
      }
    }

    //timer restart
    function restartTimer() {
      if (document.getElementById("timer").innerText == "Next game") {
        time = 21600;
        setTimeout(function request() {
          startTimer();
          setTimeout(request, 1000);
        }, 1000);
      }
    }
    const y = document.getElementById("timer");
    y.addEventListener('click', restartTimer);
  </script>
</body>

</html>